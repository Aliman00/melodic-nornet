#!/bin/bash

virsh -c qemu:///system destroy ubuntu_xenial
virsh -c qemu:///system undefine ubuntu_xenial

virt-install \
  --name ubuntu_xenial \
  --ram 1024 \
  --disk path=/storage/tmp/ubuntu_xenial-root.qcow2,format=qcow2,size=16,sparse=true,cache=unsafe \
  --network bridge=virbr0,model=virtio \
  --graphics none \
  --vcpus 1 \
  --os-type linux \
  --os-variant ubuntu16.04 \
  --console pty,target_type=serial \
  --location http://archive.ubuntu.com/ubuntu/dists/xenial/main/installer-amd64/ \
  --initrd-inject=preseed.cfg \
  --extra-args 'console=ttyS0 apt-setup/proposed=true nomodeset fb=false priority=critical locale=en_US file=preseed.cfg preseed/file=preseed.cfg' \
  --noreboot

reset
clear

virt-sysprep -d ubuntu_xenial


#   --disk path=/storage/tmp/ubuntu_xenial-swap.qcow2,format=qcow2,size=4,sparse=true,cache=unsafe  \
#   --disk path=/storage/tmp/ubuntu_xenial-home.qcow2,format=qcow2,size=8,sparse=true,cache=unsafe  \


#               1 1 1 free                                          \
#                       $bios_boot{ }                               \
#                       method{ biosgrub }                          \
#               .                                                   \
